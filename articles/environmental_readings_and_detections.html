<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Environmental readings and detections • temploapiclient</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Environmental readings and detections">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">temploapiclient</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/environmental_readings_and_detections.html">Environmental readings and detections</a></li>
    <li><a class="dropdown-item" href="../articles/station_and_receptors.html">Create stations, receptors and link them</a></li>
    <li><a class="dropdown-item" href="../articles/tagged_individuals.html">Create species, individuals, tags, sensors and link them all</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Environmental readings and detections</h1>
            
      

      <div class="d-none name"><code>environmental_readings_and_detections.Rmd</code></div>
    </div>

    
    
<style type="text/css">
pre {
  overflow-x: scroll !important;
}
</style>
<div class="section level2">
<h2 id="initial-setup-and-api-credentials">Initial Setup and Api Credentials<a class="anchor" aria-label="anchor" href="#initial-setup-and-api-credentials"></a>
</h2>
<p>Please see <a href="../articles/station_and_receptors.html">station_and_receptors</a>
for further details about how to make available the showcased package
<code>temploapiclient</code> to this vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">project_folder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">path_to_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">project_folder</span>, <span class="st">".env"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRenviron.html" class="external-link">readRenviron</a></span><span class="op">(</span><span class="va">path_to_env</span><span class="op">)</span></span>
<span><span class="va">api_base_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"API_BASE_URL"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">templo_client</span> <span class="op">&lt;-</span> <span class="fu">temploapiclient</span><span class="fu">::</span><span class="va"><a href="../reference/TemploApiClient.html">TemploApiClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">api_base_url</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://magrittr.tidyverse.org" class="external-link">"magrittr"</a></span><span class="op">)</span> <span class="co"># Make '%&gt;%' available throughout the vignette</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fetching-environmental-readings">Fetching environmental readings<a class="anchor" aria-label="anchor" href="#fetching-environmental-readings"></a>
</h2>
<p>Deployed receptors are equipped with sensors that measure
oceanographic variables such as temperature, pressure, etc… Such
readings can be obtained from the API too. Readings are generate with a
very fine time resolution, so it is advised to fetch two o three days
worth of data at the time. Otherwise, the API call may time out and
result in an error.</p>
<p>In the example below we are fetching three days worth of data for
10th, 11th and 12th October 2024. We are just selecting and renaming a
few fields for showcasing purposes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">api_data</span> <span class="op">&lt;-</span> <span class="va">templo_client</span><span class="op">$</span><span class="fu">get_environmental_readings</span><span class="op">(</span>from_date <span class="op">=</span> <span class="st">"2024-10-10"</span>, to_date <span class="op">=</span> <span class="st">"2024-10-12"</span><span class="op">)</span></span>
<span><span class="co">#&gt; INFO [2024-11-12 07:35:31] Fetching environmental readings from  2024-10-10 to 2024-10-12 ... This may take a few seconds</span></span>
<span><span class="co">#&gt; INFO [2024-11-12 07:35:33] ---&gt;Finished</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">api_data</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    variable <span class="op">=</span> <span class="va">environmental_variable_name</span>,</span>
<span>    receptor <span class="op">=</span> <span class="va">receptor_name</span>,</span>
<span>    station <span class="op">=</span> <span class="va">station_name</span>,</span>
<span>    lat <span class="op">=</span> <span class="va">latitude</span>,</span>
<span>    lon <span class="op">=</span> <span class="va">longitude</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">station</span>,</span>
<span>    <span class="va">receptor</span>,</span>
<span>    <span class="va">lat</span>,</span>
<span>    <span class="va">lon</span>,</span>
<span>    <span class="va">variable</span>,</span>
<span>    <span class="va">reading_time</span>,</span>
<span>    <span class="va">value</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt;   station receptor     lat       lon  variable        reading_time value</span></span>
<span><span class="co">#&gt; 1    Cíes     Cíes 42.2107 -8.898333 FREQUENCY 2024-10-10 00:09:42    69</span></span>
<span><span class="co">#&gt; 2    Cíes     Cíes 42.2107 -8.898333 FREQUENCY 2024-10-10 00:19:42    69</span></span>
<span><span class="co">#&gt; 3    Cíes     Cíes 42.2107 -8.898333 FREQUENCY 2024-10-10 00:29:42    69</span></span>
<span><span class="co">#&gt; 4    Cíes     Cíes 42.2107 -8.898333 FREQUENCY 2024-10-10 00:39:42    69</span></span>
<span><span class="co">#&gt; 5    Cíes     Cíes 42.2107 -8.898333 FREQUENCY 2024-10-10 00:49:42    69</span></span>
<span><span class="co">#&gt; 6    Cíes     Cíes 42.2107 -8.898333 FREQUENCY 2024-10-10 00:59:42    69</span></span></code></pre></div>
<p>We could hit an interval of time when no data was produced so an
empty dataset will be returned instead.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">api_data</span> <span class="op">&lt;-</span> <span class="va">templo_client</span><span class="op">$</span><span class="fu">get_environmental_readings</span><span class="op">(</span>from_date <span class="op">=</span> <span class="st">"2024-01-01"</span>, to_date <span class="op">=</span> <span class="st">"2024-02-02"</span><span class="op">)</span></span>
<span><span class="co">#&gt; INFO [2024-11-12 07:35:33] Fetching environmental readings from  2024-01-01 to 2024-02-02 ... This may take a few seconds</span></span>
<span><span class="co">#&gt; INFO [2024-11-12 07:35:34] ---&gt;Finished</span></span>
<span><span class="va">api_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">assertr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/assertr/reference/verify.html" class="external-link">verify</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 0</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fetching-detections">Fetching detections<a class="anchor" aria-label="anchor" href="#fetching-detections"></a>
</h2>
<p>Detections emitted by the sensors fitted in the tags that are
surgically inserted into individuals read oceanographic variables too.
Similar to environmental readings, detections should be downloaded in
small chunks to avoid the API timing out and producing no results. In
the results below we have massaged the data to provide contextual column
names and trimmed those detections that produced no value.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">api_data</span> <span class="op">&lt;-</span> <span class="va">templo_client</span><span class="op">$</span><span class="fu">get_dataframe_end_point</span><span class="op">(</span>end_point <span class="op">=</span> <span class="st">"detections/data_exports/"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  format <span class="op">=</span> <span class="st">"json"</span>, <span class="co"># this parameters, for our purposes needs no change.</span></span>
<span>  from_date <span class="op">=</span> <span class="st">"2024-10-02"</span>,</span>
<span>  to_date <span class="op">=</span> <span class="st">"2024-10-03"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; INFO [2024-11-12 07:35:34] Fetching data from api... This may take a few seconds</span></span>
<span><span class="co">#&gt; INFO [2024-11-12 07:35:35] ---&gt;Finished</span></span>
<span><span class="va">api_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>detection_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">detection_value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">assertr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/assertr/reference/not_na.html" class="external-link">not_na</a></span><span class="op">(</span><span class="va">detection_value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">sensor_id</span>,</span>
<span>    <span class="va">sensor_name</span>,</span>
<span>    <span class="va">individual_tag</span>,</span>
<span>    <span class="va">tag_model</span>,</span>
<span>    <span class="va">scientific_name</span>,</span>
<span>    <span class="va">station_name</span>,</span>
<span>    <span class="va">receptor_name</span>,</span>
<span>    <span class="va">detection_time</span>,</span>
<span>    <span class="va">detection_value</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="va">sensor_id</span>,</span>
<span>    sensor <span class="op">=</span> <span class="va">sensor_name</span>,</span>
<span>    individiual_id <span class="op">=</span> <span class="va">individual_tag</span>,</span>
<span>    station <span class="op">=</span> <span class="va">station_name</span>,</span>
<span>    receptor <span class="op">=</span> <span class="va">receptor_name</span>,</span>
<span>    time <span class="op">=</span> <span class="va">detection_time</span>,</span>
<span>    value <span class="op">=</span> <span class="va">detection_value</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     id      sensor individiual_id tag_model scientific_name station receptor</span></span>
<span><span class="co">#&gt; 1 1155    PRESSURE MOVE-RUN-23-32  03EX1155   Raja undulata    Cíes     Cíes</span></span>
<span><span class="co">#&gt; 2 1156 TEMPERATURE MOVE-RUN-23-32  03EX1156   Raja undulata    Cíes     Cíes</span></span>
<span><span class="co">#&gt; 3 1100 TEMPERATURE MOVE-RUN-23-11  03E51100   Raja undulata    Cíes     Cíes</span></span>
<span><span class="co">#&gt; 4 1151    PRESSURE MOVE-RUN-23-30  03EV1151   Raja undulata    Cíes     Cíes</span></span>
<span><span class="co">#&gt; 5 1152 TEMPERATURE MOVE-RUN-23-30  03EV1152   Raja undulata    Cíes     Cíes</span></span>
<span><span class="co">#&gt; 6 1196 TEMPERATURE MOVE-RUN-23-02  03FH1196   Raja undulata    Cíes     Cíes</span></span>
<span><span class="co">#&gt;                  time value</span></span>
<span><span class="co">#&gt; 1 2024-10-03 22:48:46    23</span></span>
<span><span class="co">#&gt; 2 2024-10-03 22:02:21   157</span></span>
<span><span class="co">#&gt; 3 2024-10-03 21:38:23   160</span></span>
<span><span class="co">#&gt; 4 2024-10-03 21:18:49  4095</span></span>
<span><span class="co">#&gt; 5 2024-10-03 20:59:59   159</span></span>
<span><span class="co">#&gt; 6 2024-10-03 20:40:53   159</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan G.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
